<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>扩展服务 | MapGIS Pan-Spatial Map</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/mapgis-pan-spatial-map-docs/favicon.ico">
    <meta name="description" content="全行业一张图应用平台">
    <meta name="keywords" content="mapgis,开源,免费,全空间,一张图">
    
    <link rel="preload" href="/mapgis-pan-spatial-map-docs/assets/css/0.styles.5aa843c2.css" as="style"><link rel="preload" href="/mapgis-pan-spatial-map-docs/assets/js/app.96984c76.js" as="script"><link rel="preload" href="/mapgis-pan-spatial-map-docs/assets/js/2.45884394.js" as="script"><link rel="preload" href="/mapgis-pan-spatial-map-docs/assets/js/66.e291c93e.js" as="script"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/10.24d51e9a.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/11.bb8852ef.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/12.43dc56b9.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/13.600a4bc3.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/14.03c9c185.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/15.e2859453.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/16.8bfd4783.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/17.49fdb1f4.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/18.1f2c72b1.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/19.42c87290.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/20.ec823e78.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/21.daf7e069.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/22.f67be05b.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/23.ca430cd9.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/24.21b98634.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/25.c00dc0b4.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/26.d981c876.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/27.7039a4df.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/28.69df2930.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/29.d01987c7.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/3.a5e2ad60.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/30.da43a06b.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/31.9d6ed078.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/32.7129312a.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/33.02b71481.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/34.9ecdd35a.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/35.021dea70.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/36.7f3d7df4.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/37.68813c86.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/38.18bc1195.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/39.048b8f10.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/4.8431eaef.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/40.f35d20f8.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/41.43d1a2bd.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/42.8c525bd2.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/43.7fdb3670.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/44.1b1333b2.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/45.91d17848.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/46.9ebc1015.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/47.f3313086.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/48.41b12be1.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/49.e6725280.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/5.15f0133f.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/50.176d9554.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/51.814ac319.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/52.715c2202.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/53.5c43e0d8.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/54.617ed9c6.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/55.98308d2b.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/56.1dadd8ba.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/57.f60be398.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/58.da8c3034.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/59.8cc0e12e.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/6.49c9592f.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/60.0074c1e3.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/61.c714c853.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/62.ecdf35f8.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/63.3830ddfa.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/64.5c02d345.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/65.7d52ebc5.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/67.309bc9aa.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/68.2ba6c36f.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/69.3e452e14.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/7.bf3cb37a.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/70.1c5341a1.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/71.4c2b1f71.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/72.770842b0.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/8.b9961f2e.js"><link rel="prefetch" href="/mapgis-pan-spatial-map-docs/assets/js/9.ffa94cd0.js">
    <link rel="stylesheet" href="/mapgis-pan-spatial-map-docs/assets/css/0.styles.5aa843c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mapgis-pan-spatial-map-docs/zh/" class="home-link router-link-active"><img src="/mapgis-pan-spatial-map-docs/logo.png" alt="MapGIS Pan-Spatial Map" class="logo"> <span class="site-name can-hide">MapGIS Pan-Spatial Map</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mapgis-pan-spatial-map-docs/zh/guide/" class="nav-link router-link-active">
  指南
</a></div><div class="nav-item"><a href="/mapgis-pan-spatial-map-docs/zh/config/common/base.html" class="nav-link">
  配置
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mapgis-pan-spatial-map-docs/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/mapgis/mapgis-pan-spatial-map" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mapgis-pan-spatial-map-docs/zh/guide/" class="nav-link router-link-active">
  指南
</a></div><div class="nav-item"><a href="/mapgis-pan-spatial-map-docs/zh/config/common/base.html" class="nav-link">
  配置
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mapgis-pan-spatial-map-docs/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/mapgis/mapgis-pan-spatial-map" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>产品介绍</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>入门</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>扩展</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html" aria-current="page" class="active sidebar-link">扩展服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#一、概述" class="sidebar-link">一、概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_1-1-扩展服务原理" class="sidebar-link">1.1 扩展服务原理</a></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_1-2-适用场景" class="sidebar-link">1.2 适用场景</a></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_1-3-插件与框架关系" class="sidebar-link">1.3 插件与框架关系</a></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_1-4-插件的classloader" class="sidebar-link">1.4 插件的classloader</a></li></ul></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#二、环境搭建和开发" class="sidebar-link">二、环境搭建和开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_2-1-项目结构" class="sidebar-link">2.1 项目结构</a></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_2-2-安装依赖" class="sidebar-link">2.2 安装依赖</a></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_2-3-插件开发" class="sidebar-link">2.3 插件开发</a></li></ul></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#三、插件运行调试" class="sidebar-link">三、插件运行调试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_3-1-编译插件" class="sidebar-link">3.1 编译插件</a></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_3-2-加载插件" class="sidebar-link">3.2 加载插件</a></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_3-3-插件开启远程调试" class="sidebar-link">3.3 插件开启远程调试</a></li></ul></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#四、插件打包和部署" class="sidebar-link">四、插件打包和部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_4-1-打包为jar-one-jar" class="sidebar-link">4.1 打包为jar （one-jar）</a></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_4-2-打包为zip" class="sidebar-link">4.2 打包为zip</a></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_4-3-插件部署" class="sidebar-link">4.3 插件部署</a></li></ul></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#五、部署后调试" class="sidebar-link">五、部署后调试</a></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#六、新增插件" class="sidebar-link">六、新增插件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_6-1-新增插件模块" class="sidebar-link">6.1 新增插件模块</a></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_6-2-定义插件属性" class="sidebar-link">6.2 定义插件属性</a></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_6-3-添加依赖" class="sidebar-link">6.3 添加依赖</a></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_6-4-编写插件类" class="sidebar-link">6.4  编写插件类</a></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_6-5-插件调试、打包和部署" class="sidebar-link">6.5 插件调试、打包和部署</a></li></ul></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#七、常见问题" class="sidebar-link">七、常见问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_7-1-package-sealing导致的依赖问题" class="sidebar-link">7.1 Package Sealing导致的依赖问题</a></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_7-2-springplugin需要注意的依赖问题" class="sidebar-link">7.2 SpringPlugin需要注意的依赖问题</a></li><li class="sidebar-sub-header"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/server-extension.html#_7-3-插件更新后没有生效" class="sidebar-link">7.3 插件更新后没有生效</a></li></ul></li></ul></li><li><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/manager-extension.html" class="sidebar-link">微应用</a></li><li><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/backfront-extension.html" class="sidebar-link">微应用结合扩展服务</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>版本</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其它</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="扩展服务"><a href="#扩展服务" class="header-anchor">#</a> 扩展服务</h1> <p>本项目是一个接入 PF4J 框架的插件模板，任何人都可以基于它进行快速扩展</p> <blockquote><p>https://pf4j.org/</p> <p>https://github.com/pf4j/pf4j</p></blockquote> <h2 id="一、概述"><a href="#一、概述" class="header-anchor">#</a> 一、概述</h2> <h3 id="_1-1-扩展服务原理"><a href="#_1-1-扩展服务原理" class="header-anchor">#</a> 1.1 扩展服务原理</h3> <p>扩展服务以插件形式承载到框架服务器中，以插件自己独立的classLoader加载到框架的JVM进程中，避免了Java类冲突，保证各个插件与框架之间的类不会相互污染，同时也保障了各个子模块的安全。</p> <blockquote><p>独立的classLoader非常重要，因为java生态圈的三方依赖非常多，依赖的版本冲突问题非常常见。各个插件、框架，彼此之间存在公共依赖的情况时常发生，通过独立的classLoader解决了插件、框架的兼容问题。</p></blockquote> <h3 id="_1-2-适用场景"><a href="#_1-2-适用场景" class="header-anchor">#</a> 1.2 适用场景</h3> <p>扩展服务适用场景：<strong>中小型Web应用</strong>程序</p> <p>不适用场景：不适合大型应用构建（大型应用使用独立服务或微服务构建），因为其能力受制于插件机制，不支持SpringBoot等大型框架。</p> <h3 id="_1-3-插件与框架关系"><a href="#_1-3-插件与框架关系" class="header-anchor">#</a> 1.3 插件与框架关系</h3> <p>框架、各个插件各自拥有独立的spring IOC容器和classloader。</p> <p>插件中的所有extension均会注册到框架的IOC容器中，但插件中的普通bean并不会注册到框架IOC容器中。</p> <p>插件与插件、插件与框架之间的交互，可通过FrameworkContextCapable接口（plugin、extension实现均可）获取框架的IOC容器，在通过框架IOC容器获取任何extension（不论哪个插件中定义的），或框架的普通bean。</p> <h3 id="_1-4-插件的classloader"><a href="#_1-4-插件的classloader" class="header-anchor">#</a> 1.4 插件的classloader</h3> <p>参考 <a href="https://pf4j.org/doc/class-loading.html" target="_blank" rel="noopener noreferrer">pf4j classloader<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
类加载的次序，默认是框架优先, PluginClassLoader 使用如下次序依次尝试加载类：</p> <ul><li>如果类名是 java.开头，则使用java system类加载器</li> <li>如果类名是org.pf4j.开头，则使用框架的类加载器</li> <li>尝试使用当前的插件类加载器</li> <li>尝试使用当前插件<strong>dependencies的其他插件类加载器</strong>加载</li> <li>尝试使用框架的类加载器</li></ul> <h2 id="二、环境搭建和开发"><a href="#二、环境搭建和开发" class="header-anchor">#</a> 二、环境搭建和开发</h2> <h3 id="_2-1-项目结构"><a href="#_2-1-项目结构" class="header-anchor">#</a> 2.1 项目结构</h3> <div class="language-text extra-class"><pre class="language-text"><code>mapgis-boot-extension
├── mapgis-plugins                 # 插件目录，设置-Dpf4j.pluginsDir参数指向的目录
│   ├── demo-plugin                # 单体示例插件
│   ├── demo-whth-deps-plugin      # 单体带本地依赖的示例插件，依赖为demo-plugin-lib
├── mapgis-plugins-deps            # 插件依赖项
│   ├── demo-plugin-lib            # demo-whth-deps-plugin插件的依赖
</code></pre></div><h3 id="_2-2-安装依赖"><a href="#_2-2-安装依赖" class="header-anchor">#</a> 2.2 安装依赖</h3> <p>插件中依赖如果已经存在于框架中，将其设置为<code>&lt;scope&gt;provided&lt;/scope&gt;</code>，因为插件可以共享框架中已存在的依赖，如果将重复的依赖加入到插件，只会增加插件的大小。</p> <p>注意如果插件中某个依赖与框架依赖同时存在，在版本不一致，这时需要在插件添加其依赖，保证插件正常运行，<strong>如果插件和框架同时存在某个依赖，插件依赖优先</strong>，类似tomcat中的webapp，这样保证不会出现类的冲突。</p> <p>插件自身的依赖包括<code>org.pf4j:pf4j、org.pf4j:pf4j-spring、org.springframework:spring-webmvc、io.swagger.core.v3:swagger-annotations、jakarta.servlet:jakarta.servlet-api、org.slf4j:slf4j-api</code>，在插件中必须设置<code>&lt;scope&gt;provided&lt;/scope&gt;</code>，否则插件无法加载。</p> <h4 id="_2-2-1-依赖声明"><a href="#_2-2-1-依赖声明" class="header-anchor">#</a> 2.2.1 依赖声明</h4> <p>插件必须有如下依赖：</p> <div class="language-xml extra-class"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
     <span class="token comment">&lt;!-- pf4j --&gt;</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.pf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>pf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
         <span class="token comment">&lt;!-- 必须与框架依赖版本保持一致 --&gt;</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>x.x.x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.pf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>pf4j-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
         <span class="token comment">&lt;!-- 必须与框架依赖版本保持一致 --&gt;</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>x.x.x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
     
     <span class="token comment">&lt;!-- api --&gt;</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.zondy.mapgis.psmap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mapgis-psmap-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
         <span class="token comment">&lt;!-- 必须与框架依赖版本保持一致 --&gt;</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>x.x.x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
     
     <span class="token comment">&lt;!-- Spring Web --&gt;</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-webmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
         <span class="token comment">&lt;!-- 必须与框架依赖版本保持一致 --&gt;</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>x.x.x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
	 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
     
     <span class="token comment">&lt;!-- swagger annotations --&gt;</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.swagger.core.v3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>swagger-annotations<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
         <span class="token comment">&lt;!-- 必须与框架依赖版本保持一致 --&gt;</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>x.x.x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

     <span class="token comment">&lt;!--java servelet标准--&gt;</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>jakarta.servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jakarta.servlet-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
         <span class="token comment">&lt;!-- 必须与框架依赖版本保持一致 --&gt;</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>x.x.x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

     <span class="token comment">&lt;!-- slf4j-api --&gt;</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
         <span class="token comment">&lt;!-- 必须与框架依赖版本保持一致 --&gt;</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>x.x.x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_2-2-2-本地依赖安装"><a href="#_2-2-2-本地依赖安装" class="header-anchor">#</a> 2.2.2 本地依赖安装</h4> <p>使用压缩工具打开产品包lib目录下的mapgis-server-x.x.x.x.jar，通过解压获取依赖jar，并手动安装依赖</p> <p>比如：安装<code>mapgis-psmap-api-x.x.x.x.jar</code></p> <blockquote><p>注意修改<code>groupId、artifactId、version</code>与插件依赖的一致</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>@REM 注意修改<span class="token variable">${dir}</span>、version参数值和jar包文件名
mvn install:install-file -DgroupId<span class="token operator">=</span>com.zondy.mapgis.psmap -DartifactId<span class="token operator">=</span>mapgis-psmap-api -Dversion<span class="token operator">=</span>x.x.x.x -Dpackaging<span class="token operator">=</span>jar -Dfile<span class="token operator">=</span><span class="token variable">${dir}</span>/mapgis-psmap-api-x.x.x.x.jar
</code></pre></div><h3 id="_2-3-插件开发"><a href="#_2-3-插件开发" class="header-anchor">#</a> 2.3 插件开发</h3> <p>插件模板提供了2种典型的插件开发场景，不带本地依赖的插件和带本地依赖的插件，并编写好了插件类、扩展服务实现类，支持Swagger3 API文档，您可以根据自己的需要直接对其进行修改或基于它新增单独的插件进行开发</p> <h2 id="三、插件运行调试"><a href="#三、插件运行调试" class="header-anchor">#</a> 三、插件运行调试</h2> <h3 id="_3-1-编译插件"><a href="#_3-1-编译插件" class="header-anchor">#</a> 3.1 编译插件</h3> <p>开发模式下，框架直接找maven编译好的class文件，而不是jar包或zip包。</p> <p>这种模式下，插件元数据信息由<code>plugin.properties</code> 定义。</p> <p>可通过插件右键<code>Build Module</code>或<code>mvn clean compile</code>来进行编译</p> <h4 id="_3-1-2-带依赖的插件编译"><a href="#_3-1-2-带依赖的插件编译" class="header-anchor">#</a> 3.1.2 带依赖的插件编译</h4> <p>插件的classloader默认只会找编译后<code>target/classes</code>文件夹，但插件还依赖了除框架（provided）之外的其他依赖，则需要使用</p> <p>插件<code>dependency</code>用来将插件的依赖拷贝到生成目录中<code>target/lib</code>文件夹下</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 如果插件存在本地（非框架提供）依赖项，比如项目依赖plugin-common-lib，调试状态下，只能通过package将依赖项拷贝到target/lib才能加入到插件类加载器中 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-dependency-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>copy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>copy-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includeScope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includeScope</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">&gt;</span></span>
                    ${project.build.directory}/lib
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>我们可以在整个项目上执行<code>mvn clean package</code>，会自动将依赖放置到对应插件的<code>target/lib</code>目录下，或对插件依赖单独进行<code>mvn clean package</code>，然后将其手动拷贝到被依赖插件的<code>target/lib</code>文件夹下，还可以采用对带有依赖的插件进行多模块打包<code>mvn package -pl com.zondy.mapgis:demo-plugin -am</code>同样可以实现<code>target/lib</code>的自动放置。</p> <h3 id="_3-2-加载插件"><a href="#_3-2-加载插件" class="header-anchor">#</a> 3.2 加载插件</h3> <p>插件的插件通过框架来完成，所以需要给框架应用启动项添加参数</p> <h4 id="_3-2-1-有框架源码"><a href="#_3-2-1-有框架源码" class="header-anchor">#</a> 3.2.1 有框架源码</h4> <p>直接给框架应用模块启动项添加JVM参数<code>-Dpf4j.mode=development</code>开启调试模式，添加JVM参数<code>-Dpf4j.pluginsDir=${dir}</code>设置插件目录，添加JVM参数<code>-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005</code>进行调试监听</p> <blockquote><p>这里的dir指向的是插件所在的目录，对模板项目来说就是mapgis-plugins所在的目录</p></blockquote> <p>比如：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>-Dpf4j.mode<span class="token operator">=</span>development -Dpf4j.pluginsDir<span class="token operator">=</span>D:<span class="token punctuation">\</span>mapgis-boot-extension<span class="token punctuation">\</span>mapgis-plugins -agentlib:jdwp<span class="token operator">=</span>transport<span class="token operator">=</span>dt_socket,server<span class="token operator">=</span>y,suspend<span class="token operator">=</span>n,address<span class="token operator">=</span><span class="token number">5005</span>
</code></pre></div><blockquote><p>注意：要调试插件的话，框架需要以Run模式启动，不能以Debug模式启动，因为Debug模式启动时，框架会自己进行附加调试，导致插件项目无法进行附加调试</p></blockquote> <h4 id="_3-2-2-无框架源码"><a href="#_3-2-2-无框架源码" class="header-anchor">#</a> 3.2.2 无框架源码</h4> <p>需要在产品包<code>bin/startup-server.bat</code>中添加相关启动参数</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">set</span> <span class="token assign-left variable">JAVA_OPTS</span><span class="token operator">=</span>-Xms256m -Xmx1024m -XX:MetaspaceSize<span class="token operator">=</span>128m -XX:MaxMetaspaceSize<span class="token operator">=</span>512m -Dfile.encoding<span class="token operator">=</span>UTF-8 -DCONSOLE_CHARSET<span class="token operator">=</span>GBK -DCONSOLE_WITH_JANSI<span class="token operator">=</span>true -Dspring.output.ansi.enabled<span class="token operator">=</span>ALWAYS -Dxxx.home<span class="token operator">=</span>.

@REM 追加下面一行，注意修改%plugins_dir%的值
<span class="token builtin class-name">set</span> <span class="token assign-left variable">JAVA_OPTS</span><span class="token operator">=</span>%JAVA_OPTS% -Dpf4j.mode<span class="token operator">=</span>development -Dpf4j.pluginsDir<span class="token operator">=</span>D:<span class="token punctuation">\</span>mapgis-boot-extension<span class="token punctuation">\</span>mapgis-plugins -agentlib:jdwp<span class="token operator">=</span>transport<span class="token operator">=</span>dt_socket,server<span class="token operator">=</span>y,suspend<span class="token operator">=</span>n,address<span class="token operator">=</span><span class="token number">5005</span>
</code></pre></div><blockquote><p>这里的-Dpf4j.pluginsDir=指向的是插件所在的目录，对模板项目来说就是mapgis-plugins所在的目录</p></blockquote> <h3 id="_3-3-插件开启远程调试"><a href="#_3-3-插件开启远程调试" class="header-anchor">#</a> 3.3 插件开启远程调试</h3> <p>通过设置插件项目的Configurations可开启JVM远程调试</p> <ol><li><p>Edit Configurations或通过 Shift+Alt+F10 快捷键打开</p></li> <li><p>Add New Configuration：Remote JVM Debug</p></li> <li><p>Command line arguments for remote JVM：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>-agentlib:jdwp<span class="token operator">=</span>transport<span class="token operator">=</span>dt_socket,server<span class="token operator">=</span>y,suspend<span class="token operator">=</span>n,address<span class="token operator">=</span><span class="token number">5005</span>
</code></pre></div><blockquote><p>注意：此处的端口与框架启动时监听调试的端口保持一致</p></blockquote></li> <li><p>点击Debug，会提示<code>Connected to the target VM, address: 'localhost:5005', transport: 'socket'</code></p></li> <li><p>添加断点进行调试</p> <p>比如：给demo-plugin的TestController中的getRes方法内添加断点，访问http://localhost:8015/psmap/rest/services/demo-plugin/ExtensionServer/test查看是否进入代码</p></li></ol> <h2 id="四、插件打包和部署"><a href="#四、插件打包和部署" class="header-anchor">#</a> 四、插件打包和部署</h2> <h3 id="_4-1-打包为jar-one-jar"><a href="#_4-1-打包为jar-one-jar" class="header-anchor">#</a> 4.1 打包为jar （one-jar）</h3> <p>执行mvn package可进行插件打包，可对整个项目进行打包或对带有依赖的插件进行多模块打包。</p> <p>插件模板内置了打包插件，推荐插件打包使用maven-assembly-plugin，打包为one-jar，如下：</p> <div class="language-xml extra-class"><pre class="language-xml"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-assembly-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptorRefs</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptorRef</span><span class="token punctuation">&gt;</span></span>jar-with-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptorRef</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptorRefs</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>finalName</span><span class="token punctuation">&gt;</span></span>${project.artifactId}-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>finalName</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appendAssemblyId</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appendAssemblyId</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attach</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attach</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>archive</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifest</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>addDefaultImplementationEntries</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>addDefaultImplementationEntries</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>addDefaultSpecificationEntries</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>addDefaultSpecificationEntries</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifest</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifestEntries</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Plugin-Id</span><span class="token punctuation">&gt;</span></span>${plugin.id}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Plugin-Id</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Plugin-Version</span><span class="token punctuation">&gt;</span></span>${plugin.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Plugin-Version</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Plugin-Provider</span><span class="token punctuation">&gt;</span></span>${plugin.provider}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Plugin-Provider</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Plugin-Class</span><span class="token punctuation">&gt;</span></span>${plugin.class}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Plugin-Class</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Plugin-Dependencies</span><span class="token punctuation">&gt;</span></span>${plugin.dependencies}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Plugin-Dependencies</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifestEntries</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>archive</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>make-assembly<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>single<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_4-2-打包为zip"><a href="#_4-2-打包为zip" class="header-anchor">#</a> 4.2 打包为zip</h3> <p>插件同时支持打包为zip格式，显著的差别是将插件的依赖jar原封不动的放到lib文件夹下，zip格式插件包在运行时会自动解压到同级目录，内部包括classes文件夹和lib文件夹。</p> <p>插件模板对于带有依赖的插件提供了<code>plugin-zip-package</code>配置选项，可勾选后将插件打包为zip形式，详细配置如下：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-jar-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>archive</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifestEntries</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Plugin-Id</span><span class="token punctuation">&gt;</span></span>${plugin.id}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Plugin-Id</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Plugin-Class</span><span class="token punctuation">&gt;</span></span>${plugin.class}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Plugin-Class</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Plugin-Version</span><span class="token punctuation">&gt;</span></span>${plugin.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Plugin-Version</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Plugin-Provider</span><span class="token punctuation">&gt;</span></span>${plugin.provider}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Plugin-Provider</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Plugin-Dependencies</span><span class="token punctuation">&gt;</span></span>${plugin.dependencies}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Plugin-Dependencies</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifestEntries</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>archive</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-antrun-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>unzip jar file<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>unzip</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>target/${project.artifactId}-${project.version}.${project.packaging}<span class="token punctuation">&quot;</span></span>
                                    <span class="token attr-name">dest</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>target/plugin-classes<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>run<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-assembly-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptors</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptor</span><span class="token punctuation">&gt;</span></span>
                        src/main/assembly/assembly.xml
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptor</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptors</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appendAssemblyId</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appendAssemblyId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>make-assembly<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>single<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-deploy-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>skip</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>skip</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>同时在src/main/assembly中添加有assembly.xml，内容如下：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assembly</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>formats</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>format</span><span class="token punctuation">&gt;</span></span>zip<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>format</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>formats</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includeBaseDirectory</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includeBaseDirectory</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencySets</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencySet</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>useProjectArtifact</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>useProjectArtifact</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">&gt;</span></span>lib<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>*:jar:*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencySet</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencySets</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--
    &lt;fileSets&gt;
        &lt;fileSet&gt;
            &lt;directory&gt;target/classes&lt;/directory&gt;
            &lt;outputDirectory&gt;classes&lt;/outputDirectory&gt;
        &lt;/fileSet&gt;
    &lt;/fileSets&gt;
    --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSets</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>target/plugin-classes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">&gt;</span></span>classes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSets</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>assembly</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_4-3-插件部署"><a href="#_4-3-插件部署" class="header-anchor">#</a> 4.3 插件部署</h3> <p>打包后的结果如下：</p> <div class="language-text extra-class"><pre class="language-text"><code>mapgis-boot-extension
├── mapgis-plugins                                # 插件目录，设置-Dpf4j.pluginsDir参数指向的目录
│   ├── demo-plugin                               # 单体示例插件
│       ├── target                            
│           ├── demo-plugin-plugin.jar            # xyz-plugin.jar为插件模块
│   ├── demo-whth-deps-plugin                     # 单体带本地依赖的示例插件，依赖为demo-plugin-lib
│       ├── target                            
│           ├── demo-whth-deps-plugin-plugin.jar  # xyz-plugin.jar为插件模块
│           ├── demo-whth-deps-plugin-plugin.zip  # xyz-plugin.zip为zip格式的插件模块
├── mapgis-plugins-deps                           # 插件依赖项
│   ├── demo-plugin-lib                           # demo-whth-deps-plugin插件的依赖
│       ├── target                            
│           ├── demo-plugin-lib-x.x.x.x.jar       # 插件依赖jar
</code></pre></div><p>插件target目录下的xyz-plugin.jar或xyz-plugin.zip才是真正可以部署的插件模块，将其放到框架生成的产品包下的的plugins目录内即可</p> <div class="language-text extra-class"><pre class="language-text"><code>├── bin                                           # 可执行脚本
├── config                                        # 配置
├── lib                                           # 库
├── support                                       # 支持程序
├── plugins                                       # 插件目录
│   ├── demo-plugin-plugin.jar                    # 单体示例插件
│   ├── demo-whth-deps-plugin-plugin.jar          # 单体带本地依赖的示例插件（或zip格式）
</code></pre></div><h2 id="五、部署后调试"><a href="#五、部署后调试" class="header-anchor">#</a> 五、部署后调试</h2> <p>产品部署后同样可以进行调试，需要在产品包<code>bin/startup-server.bat</code>中添加相关启动参数</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">set</span> <span class="token assign-left variable">JAVA_OPTS</span><span class="token operator">=</span>-Xms256m -Xmx1024m -XX:MetaspaceSize<span class="token operator">=</span>128m -XX:MaxMetaspaceSize<span class="token operator">=</span>512m -Dfile.encoding<span class="token operator">=</span>UTF-8 -DCONSOLE_CHARSET<span class="token operator">=</span>GBK -DCONSOLE_WITH_JANSI<span class="token operator">=</span>true -Dspring.output.ansi.enabled<span class="token operator">=</span>ALWAYS -Dxxx.home<span class="token operator">=</span>.

@REM 追加下面一行，注意修改%plugins_dir%的值
<span class="token builtin class-name">set</span> <span class="token assign-left variable">JAVA_OPTS</span><span class="token operator">=</span>%JAVA_OPTS% -agentlib:jdwp<span class="token operator">=</span>transport<span class="token operator">=</span>dt_socket,server<span class="token operator">=</span>y,suspend<span class="token operator">=</span>n,address<span class="token operator">=</span><span class="token number">5005</span>
</code></pre></div><p>启动框架后，再对插件开启远程调试就可以进行调试了。</p> <blockquote><p>此处的参数与前面无框架源码设置的参数不同至于在于，是否添加了-Dpf4j.mode=development，这里调试依赖的jar或zip，前面依赖的class文件（不需要打包）</p></blockquote> <h2 id="六、新增插件"><a href="#六、新增插件" class="header-anchor">#</a> 六、新增插件</h2> <h3 id="_6-1-新增插件模块"><a href="#_6-1-新增插件模块" class="header-anchor">#</a> 6.1 新增插件模块</h3> <p>在mapgis-plugins模块内新增插件模块，模块名可为与下一步的插件id保持一致</p> <h3 id="_6-2-定义插件属性"><a href="#_6-2-定义插件属性" class="header-anchor">#</a> 6.2 定义插件属性</h3> <p>插件属性用来标识插件，为同时支持开发模式和运行模式，需要同时在pom.xml和plugin.properties中指定插件的属性</p> <div class="language-text extra-class"><pre class="language-text"><code>demo-plugin                        # 插件
├── src                            # 插件源码
├── pom.xml                        # Maven配置文件，用于运行模式下框架加载插件
├── plugin.properties              # 属性配置文件，用于开发模式下框架加载插件
</code></pre></div><p><strong>插件id必须保证唯一性</strong>，class为Plugin实现类，如果是扩展的SpringMvc REST服务，服务承载到框架中时将添加<code>/psmap/rest/services/{plugin-id}/ExtensionServer</code></p> <p><code>pom.xml</code>示例：</p> <div class="language-xml extra-class"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
     <span class="token comment">&lt;!-- Override below properties in each plugin's pom.xml --&gt;</span>
     <span class="token comment">&lt;!-- 插件实现中必须包括如下配置项--&gt;</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin.id</span><span class="token punctuation">&gt;</span></span>demo-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin.id</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin.class</span><span class="token punctuation">&gt;</span></span>com.zondy.mapgis.plugins.demo.DemoPlugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin.class</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin.version</span><span class="token punctuation">&gt;</span></span>0.0.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin.version</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin.provider</span><span class="token punctuation">&gt;</span></span>MapGIS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin.provider</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin.dependencies</span><span class="token punctuation">/&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>plugin.properties</code>示例：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name"> plugin.id</span><span class="token punctuation">=</span><span class="token attr-value">demo-plugin</span>
<span class="token attr-name"> plugin.class</span><span class="token punctuation">=</span><span class="token attr-value">com.zondy.mapgis.plugins.demo.DemoPlugin</span>
<span class="token attr-name"> plugin.version</span><span class="token punctuation">=</span><span class="token attr-value">0.0.1</span>
<span class="token attr-name"> plugin.provider</span><span class="token punctuation">=</span><span class="token attr-value">MapGIS</span>
<span class="token attr-name"> plugin.dependencies</span><span class="token punctuation">=</span>
</code></pre></div><p>如果多个插件之间有依赖关系，这里通过<code>plugin.dependencies</code>属性声明插件的依赖项，具体依赖声明写法参考<a href="https://pf4j.org/doc/plugins.html" target="_blank" rel="noopener noreferrer">pf4j插件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="_6-3-添加依赖"><a href="#_6-3-添加依赖" class="header-anchor">#</a> 6.3 添加依赖</h3> <p>在pom.xml中添加必要的依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-webmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.swagger.core.v3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>swagger-annotations<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_6-4-编写插件类"><a href="#_6-4-编写插件类" class="header-anchor">#</a> 6.4  编写插件类</h3> <p>创建plugin类，即前面提到的plugin.class，示例如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoPlugin</span> <span class="token keyword">extends</span> <span class="token class-name">SpringPlugin</span> <span class="token keyword">implements</span> <span class="token class-name">FrameworkContextCapable</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">DemoPlugin</span><span class="token punctuation">(</span><span class="token class-name">PluginWrapper</span> wrapper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;DemoPlugin.start,mode:{}&quot;</span><span class="token punctuation">,</span> wrapper<span class="token punctuation">.</span><span class="token function">getRuntimeMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;DemoPlugin.stop()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">ApplicationContext</span> <span class="token function">createApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//这里创建插件自身的IOC容器</span>
        <span class="token class-name">AnnotationConfigApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        applicationContext<span class="token punctuation">.</span><span class="token function">setClassLoader</span><span class="token punctuation">(</span><span class="token function">getWrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPluginClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        applicationContext<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">SpringConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        applicationContext<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> applicationContext<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setFrameworkApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//这里获取框架的IOC容器</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;framework applicationContext:&quot;</span> <span class="token operator">+</span> applicationContext<span class="token punctuation">.</span><span class="token function">getApplicationName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>上述代码，声明了一个SpringPlugin，并创建了一个插件自身的IOC容器，注意如果插件内部不需要spring IOC，则实现Plugin接口即可。</p> <p>这里可选择实现FrameworkContextCapable接口来获取框架的IOC容器。</p></blockquote> <p>创建SpringMvc Controller扩展服务实现类，添加spring的REST服务注解@RestController或@Controller，同时必须添加注解@Extension和实现Rest扩展服务接口ControllerExtension，可选择实现FrameworkContextCapable接口来获取框架的IOC容器，示例如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Tag</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;demo-plugin扩展服务&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@Extension</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token keyword">implements</span> <span class="token class-name">ControllerExtension</span><span class="token punctuation">,</span> <span class="token class-name">FrameworkContextCapable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MessageProvider</span> messageProvider<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setFrameworkApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext <span class="token operator">=</span> applicationContext<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;获取结果信息&quot;</span><span class="token punctuation">)</span>    
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/res&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResObj</span> <span class="token function">getRes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> msg <span class="token operator">=</span> messageProvider<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ResObj</span> resObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resObj<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resObj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中注解<code>@Tag</code>,<code>@Operation</code>为OpenApi3注解，用于生成swagger文档</p> <p>上述示例REST服务的访问基地址为<code>http://localhost:8015/psmap/rest/services/demo-plugin/ExtensionServer</code></p> <blockquote><p>其中<code>demo-plugin</code>为插件id，对应上文plugin.properties或pom.xml文件中<code>plugin.id</code>的属性值</p></blockquote> <p>xxx为扩展服务添加的REST服务前缀，接口ControllerExtension默认实现了服务自述信息方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ControllerExtension</span> <span class="token keyword">extends</span> <span class="token class-name">ExtensionPoint</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 当前REST扩展服务的自述信息
     * 开发者可根据实际需要，实现该方法，将扩展服务的详细自述信息通过该接口提供给使用者
     *
     * @return 返回text的信息
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">default</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">getServiceInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">&quot;这是一个基于SpringMVC的REST扩展服务：&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当请求服务基地址<code>http://localhost:8015/psmap/rest/services/demo-plugin/ExtensionServer</code>，将返回如下信息：</p> <div class="language-text extra-class"><pre class="language-text"><code>这是一个基于SpringMVC的REST扩展服务：com.zondy.mapgis.psmap.plugins.demo.DemoPlugin
</code></pre></div><p>开发者也可实现接口，实现自定义的服务自述信息接口，示例如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;服务信息&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">getServiceInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">&quot;这是插件demo-plugin提供的REST扩展服务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当进入<code>http://localhost:8015/webjars/swagger-ui/index.html</code>，可查看所有扩展服务的REST接口文档</p> <h3 id="_6-5-插件调试、打包和部署"><a href="#_6-5-插件调试、打包和部署" class="header-anchor">#</a> 6.5 插件调试、打包和部署</h3> <p>可参考前面的内容</p> <h2 id="七、常见问题"><a href="#七、常见问题" class="header-anchor">#</a> 七、常见问题</h2> <h3 id="_7-1-package-sealing导致的依赖问题"><a href="#_7-1-package-sealing导致的依赖问题" class="header-anchor">#</a> 7.1 Package Sealing导致的依赖问题</h3> <p>https://docs.oracle.com/javase/tutorial/deployment/jar/sealman.html</p> <p>Java JAR 提供了 Seal Package 选项。如果你使用了该选项，意味着任何程序都应该从 jar 里面加载所有类。如果从其它 Jar 中加载该包下面的类将会引发<code>java.lang.SecurityException</code></p> <p>部分三方库，比如<code>org.hsqldb:hsqldb</code>，就配置了sealed:true。因此就不能出现框架跟插件均包括该库的情况，该库目前已经存在框架中，则插件必须手动排除。</p> <h3 id="_7-2-springplugin需要注意的依赖问题"><a href="#_7-2-springplugin需要注意的依赖问题" class="header-anchor">#</a> 7.2 SpringPlugin需要注意的依赖问题</h3> <p>插件类型为SpringPlugin，这时插件中的Spring IOC是由框架提供支撑的，这时插件的Classloader是不能重复出现pf4j-spring相关的（<strong>spring-context、spring-core</strong>）依赖的，否则插件中的IOC容器会报错。</p> <h3 id="_7-3-插件更新后没有生效"><a href="#_7-3-插件更新后没有生效" class="header-anchor">#</a> 7.3 插件更新后没有生效</h3> <p>需要排查插件添加、删除后是否有重启服务，因为插件的加载是在框架启动时进行的，所以当插件进行了添加和删除后，必须重启框架服务</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/mapgis/mapgis-pan-spatial-map-docs/edit/master/docs/zh/guide/extension/server-extension.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2024/3/12 14:08:09</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mapgis-pan-spatial-map-docs/zh/guide/advanced/style-guide.html" class="prev">
        编码规范
      </a></span> <span class="next"><a href="/mapgis-pan-spatial-map-docs/zh/guide/extension/manager-extension.html">
        微应用
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><div class="my-popup" style="display:none;" data-v-3414bdeb><div class="my-popup-container" data-v-3414bdeb><div class="my-popup-exit" data-v-3414bdeb></div> <img src="" alt data-v-3414bdeb></div></div></div></div>
    <script src="/mapgis-pan-spatial-map-docs/assets/js/app.96984c76.js" defer></script><script src="/mapgis-pan-spatial-map-docs/assets/js/2.45884394.js" defer></script><script src="/mapgis-pan-spatial-map-docs/assets/js/66.e291c93e.js" defer></script>
  </body>
</html>
